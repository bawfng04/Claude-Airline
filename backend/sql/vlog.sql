-- Ensure you are connected to your `claude_airlines` database before running this.

-- Drop tables in reverse order of dependency if they already exist
-- to ensure a clean setup if re-running the script.
DROP TABLE IF EXISTS `vlog_comments`;
DROP TABLE IF EXISTS `vlog_posts`;

-- --------------------------------------------------------
-- Table structure for `vlog_posts`
-- --------------------------------------------------------
CREATE TABLE `vlog_posts` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL COMMENT 'Author (FK to USERS.ID)',
  `title` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `slug` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `introduction` text COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `content` longtext COLLATE utf8mb4_unicode_ci NOT NULL,
  `featured_image_url` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `status` enum('published','draft') COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'draft',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `slug` (`slug`),
  KEY `vlog_post_author_fk` (`user_id`),
  -- Removed the trailing comma from the end of this line
  CONSTRAINT `vlog_post_author_fk` FOREIGN KEY (`user_id`) REFERENCES `USERS` (`ID`) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Stores vlog post entries';


-- --------------------------------------------------------
-- Table structure for `vlog_comments`
-- --------------------------------------------------------
CREATE TABLE `vlog_comments` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `post_id` int(11) NOT NULL,
  `user_id` int(11) DEFAULT NULL COMMENT 'Commenter (FK to USERS.ID), NULL for guests',
  `guest_name` varchar(100) COLLATE utf8mb4_unicode_ci DEFAULT NULL,
  `comment` text COLLATE utf8mb4_unicode_ci NOT NULL,
  `rating` tinyint(3) unsigned DEFAULT NULL,
  `is_approved` tinyint(1) NOT NULL DEFAULT 0 COMMENT '0=pending, 1=approved',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `post_id` (`post_id`),
  KEY `comment_user_fk` (`user_id`),
  CONSTRAINT `vlog_comments_post_fk` FOREIGN KEY (`post_id`) REFERENCES `vlog_posts` (`id`) ON DELETE CASCADE,
  -- Removed the trailing comma from the end of this line too
  CONSTRAINT `vlog_comments_user_fk` FOREIGN KEY (`user_id`) REFERENCES `USERS` (`ID`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Stores comments for vlog posts';


-- --------------------------------------------------------
--                      SAMPLE DATA
-- --------------------------------------------------------

-- IMPORTANT: Replace placeholder passwords with real hashes generated by password_hash()!
--            Adjust column names to exactly match your USERS table schema.
-- Sample USERS (Add these BEFORE posts/comments)
INSERT IGNORE INTO `USERS` (`ID`, `FAMILY_NAME`, `GIVEN_NAME`, `EMAIL`, `PASSWORD`, `BIRTHDAY`, `NATIONALITY`, `ROLE`, `ACTIVE`, `CREATED_AT`, `UPDATED_AT`) VALUES
(1, 'Admin', 'User', 'admin@claudeair.test', '$2y$10$placeholderhashfortestingonly1', '1990-01-01', 'Testland', 'ADMIN', 1, NOW(), NOW()),
(2, 'Test', 'User', 'user@claudeair.test', '$2y$10$placeholderhashfortestingonly2', '1995-05-10', 'Testland', 'USER', 1, NOW(), NOW()),
(3, 'Vlogger', 'Pro', 'pro.vlogger@claudeair.test', '$2y$10$placeholderhashfortestingonly3', '1988-11-20', 'Travelonia', 'ADMIN', 1, NOW(), NOW()),
(4, 'Commenter', 'Frequent', 'freq.commenter@email.test', '$2y$10$placeholderhashfortestingonly4', '2000-03-15', 'Blogland', 'USER', 1, NOW(), NOW());


-- Sample Vlog Posts (Ensure user_id exists from above inserts)
INSERT INTO `vlog_posts` (`user_id`, `title`, `slug`, `introduction`, `content`, `featured_image_url`, `status`, `created_at`, `updated_at`) VALUES
(1, 'Exploring the Wonders of Ha Long Bay', 'exploring-the-wonders-of-ha-long-bay', 'Discover the magic of Ha Long Bay, a UNESCO World Heritage site famed for its emerald waters and thousands of limestone karsts.', '<p>Ha Long Bay, a UNESCO World Heritage site...</p>', 'https://placehold.co/800x400/5DADE2/FFFFFF?text=Ha+Long+Bay', 'published', NOW() - INTERVAL 7 DAY, NOW() - INTERVAL 7 DAY),
(1, 'A Culinary Journey Through Ho Chi Minh City', 'culinary-journey-ho-chi-minh-city', 'Dive into the vibrant street food scene and hidden culinary gems of Vietnam\'s bustling southern metropolis.', '<h2>A Food Lover\'s Paradise!</h2>...', 'https://placehold.co/800x400/F5B041/FFFFFF?text=HCMC+Food', 'published', NOW() - INTERVAL 5 DAY, NOW() - INTERVAL 4 DAY),
(3, 'My Trip Planning Guide (Draft)', 'trip-planning-guide-draft', 'A sneak peek into my essential steps for planning your next big adventure without the stress.', '<p>Planning a big trip can feel overwhelming...</p>', NULL, 'draft', NOW() - INTERVAL 1 DAY, NOW() - INTERVAL 1 DAY), -- Written by User 3
(1, 'Relaxing on Phu Quoc Island', 'relaxing-on-phu-quoc-island', 'White sand beaches, clear turquoise waters, and stunning sunsets await on Vietnam\'s paradise island.', '<p>Phu Quoc offers pristine beaches...</p>', 'https://placehold.co/800x400/58D68D/FFFFFF?text=Phu+Quoc', 'published', NOW() - INTERVAL 10 DAY, NOW() - INTERVAL 10 DAY),
(3, 'Trekking Adventures in Sapa', 'trekking-adventures-sapa', 'Explore the breathtaking terraced rice fields and vibrant cultures of the ethnic minority villages in Northern Vietnam.', '<h2>Into the Clouds</h2>...', 'https://placehold.co/800x400/AF7AC5/FFFFFF?text=Sapa+Trek', 'published', NOW() - INTERVAL 15 DAY, NOW() - INTERVAL 14 DAY), -- Written by User 3
(1, 'Ancient Charms of Hoi An', 'ancient-charms-hoi-an', 'Step back in time in the lantern-lit streets of Hoi An, a perfectly preserved ancient trading port.', '<p>Hoi An\'s Ancient Town...</p>', 'https://placehold.co/800x400/F4D03F/FFFFFF?text=Hoi+An', 'published', NOW() - INTERVAL 20 DAY, NOW() - INTERVAL 20 DAY),
(1, 'Mekong Delta Discovery: Waterways and Orchards', 'mekong-delta-discovery', 'Explore the intricate network of rivers, canals, and lush fruit orchards in the "rice bowl" of Vietnam.', '<p>A day trip or overnight stay in the Mekong Delta...</p>', 'https://placehold.co/800x400/48C9B0/FFFFFF?text=Mekong+Delta', 'published', NOW() - INTERVAL 25 DAY, NOW() - INTERVAL 25 DAY);


-- ** Check the actual IDs inserted into vlog_posts above before running the comments below **
-- ** Assuming Ha Long Bay=1, HCMC=2, Draft=3, Phu Quoc=4, Sapa=5, Hoi An=6, Mekong=7 **

-- Sample Comments (Ensure user_ids 1, 2, 3, 4 exist)
INSERT INTO `vlog_comments` (`post_id`, `user_id`, `guest_name`, `comment`, `rating`, `is_approved`, `created_at`) VALUES
(1, 2, NULL, 'Ha Long Bay looks amazing! I want to go.', 5, 1, NOW() - INTERVAL 6 DAY),
(2, 2, NULL, 'Great recommendations! Pho is my favorite.', 4, 1, NOW() - INTERVAL 3 DAY),
(1, NULL, 'Visitor Ann', 'Was the cruise expensive?', NULL, 0, NOW() - INTERVAL 2 DAY),
(2, 1, NULL, 'Don\'t forget Com Tam!', 5, 1, NOW() - INTERVAL 1 DAY),
(4, 2, NULL, 'Phu Quoc seems like the perfect place to unwind.', 5, 1, NOW() - INTERVAL 9 DAY),
(5, NULL, 'Trekker Tom', 'How difficult was the Sapa trek for beginners?', NULL, 1, NOW() - INTERVAL 13 DAY),
(6, 1, NULL, 'Hoi An tailors are the best!', 5, 1, NOW() - INTERVAL 19 DAY),
(7, 2, NULL, 'The Mekong Delta boat trip was so peaceful.', 4, 1, NOW() - INTERVAL 24 DAY),
(5, 4, NULL, 'Sapa looks stunning! Added to my list.', 5, 0, NOW() - INTERVAL 1 DAY), -- Comment by User 4, Pending
(6, NULL, 'Culture Vulture', 'I loved the lanterns in Hoi An!', 5, 1, NOW() - INTERVAL 18 DAY),
(7, 4, NULL, 'Did you see the coconut candy making process?', 3, 1, NOW() - INTERVAL 23 DAY); -- Comment by User 4

